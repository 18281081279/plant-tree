<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
    <style>
      body {
        background-color: #ddd;
      }
      input {
        position: absolute;
        z-index: 1000;
      }
      canvas {
        position: absolute;
        left: 0;
        top: 0;
      }
    </style>
  </head>
  <body>
    <input type="color" value="#2291a9" />
    <canvas id="tree"></canvas>
    <script>
      const treeCanvas = document.getElementById('tree');
      const color = document.getElementsByTagName('input')[0];
      treeCanvas.width = window.innerWidth - 1;
      treeCanvas.height = window.innerHeight;
      const tCxt = treeCanvas.getContext('2d');
      const treeRoot = document.documentElement.clientHeight; //树起始位置
      let treeColor = '#2291a9'; //树颜色

      //更改树的颜色
      function updateColor() {
        treeColor = this.value;
      }
      color.addEventListener('change', updateColor);

      function drawTree(x, y, deg, step) {
        const x1 = x + Math.cos(deg) * step; //越细的枝干越短，所以以步长来做
        const y1 = y + Math.sin(deg) * step;
        tCxt.lineCap = 'round';
        tCxt.strokeStyle = treeColor;
        tCxt.beginPath();
        tCxt.lineWidth = step / 4; //树干越来越细
        tCxt.moveTo(x, y);
        tCxt.lineTo(x1, y1);
        tCxt.stroke();
        step--;
        if (step > 0) {
          setTimeout(() => {
            drawTree(x1, y1, deg, step);
          }, 2);

          if (step % Math.round(Math.random() * 2 + 1) == 1)
            setTimeout(() => {
              drawTree(
                x1,
                y1,
                deg + Math.random() * 0.3 + 0.4,
                Math.round(step / (1.1 + Math.random()))
              ); //右分叉
            }, 0);

          if (step % Math.round(Math.random() * 2 + 1) == 0)
            setTimeout(() => {
              drawTree(
                x1,
                y1,
                deg - Math.random() * 0.3 - 0.4,
                Math.round(step / (1.1 + Math.random()))
              ); //左分叉
            }, 0);
        }
      }
      tree.addEventListener('click', () => {
        const x = window.event.clientX;
        const d = (document.documentElement.clientHeight - 20) / 38;
        let y = Math.floor((document.documentElement.clientHeight - window.event.clientY) / d);
        y = y < 20 ? 20 : y;
        drawTree(x, treeRoot, -Math.PI / 2, y, 1); //执行
      });
    </script>
  </body>
</html>
